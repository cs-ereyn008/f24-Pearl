<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Traffic Tamer - Search Results</title>
    <link rel="icon" href="images/stoplight.png" type="image/png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }

        body {
            background: linear-gradient(to bottom, #89CFF0, #003366);
            color: #ffffff;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Custom scrollbar styles */
        ::-webkit-scrollbar {
            width: 18px;
        }

        ::-webkit-scrollbar-track {
            background: #003366;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #00aaff;
            border-radius: 6px;
            border: 3px solid #003366;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: #00ccff;
        }

        header {
            background-color: transparent;
            padding: 20px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .navbar h1 {
            color: #ffffff;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .navbar h1 img {
            height: 12px;
            width: 15px;
            margin-left: 10px;
            vertical-align: middle;
        }

        nav ul {
            list-style-type: none;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        nav ul li {
            display: inline-block;
        }

        nav ul li a {
            padding: 10px 20px;
            background: #0044cc;
            border: 2px solid #00ffff;
            border-radius: 20px;
            color: #ffffff;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
            text-align: center;
        }

        nav ul li a:hover {
            background: #00ffff;
            color: #003366;
        }

        .content {
            background-color: #ffffff;
            color: #003366;
            padding: 20px;
            margin: 20px auto;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            overflow-x: hidden;
            /* Prevent horizontal overflow */
        }

        #result-content {
            word-wrap: break-word;
            overflow-wrap: break-word;
            white-space: pre-wrap;
            width: 100%;
            max-width: 100%;
            overflow: visible;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            color: #333;
            border-radius: 8px;
            box-sizing: border-box;
        }


        .section-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #003366;
            text-shadow: 0px 0px 10px #00aaff;
        }

        .section-subtitle {
            font-size: 18px;
            font-weight: bold;
            margin-top: 20px;
            margin-bottom: 10px;
            color: #003366;
        }

        ul {
            padding-left: 40px;
            list-style-type: disc;
        }

        ul ul {
            padding-left: 20px;
            list-style-type: circle;
        }

        footer {
            background-color: #003366;
            color: #ffffff;
            text-align: center;
            padding: 20px;
            margin-top: auto;
        }

        .question-section {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
        }

        .question {
            margin-bottom: 15px;
        }

        .question label {
            display: block;
            margin-bottom: 5px;
        }

        .question-buttons {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .question-buttons input[type="radio"] {
            margin-right: 10px;
        }

        .buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .buttons a {
            padding: 10px 20px;
            background: #0044cc;
            border: 2px solid #00ffff;
            border-radius: 20px;
            color: #ffffff;
            text-decoration: none;
            font-size: 16px;
            text-align: center;
            transition: background 0.3s ease;
        }

        .buttons a:hover {
            background: #00ffff;
            color: #003366;
        }

        .simplify-btn {
            padding: 10px 20px;
            background: #0044cc;
            border: 2px solid #00ffff;
            border-radius: 20px;
            color: #ffffff;
            text-decoration: none;
            font-size: 16px;
            text-align: center;
            transition: background 0.3s ease;
        }

        .simplify-btn:hover {
            background: #00ffff;
            color: #003366;
        }
    </style>
</head>

<body>

    <header>
        <h1><img src="images/TinyStoplight.png" alt="Stoplight"> Traffic Tamer</h1>
        <div class="navbar">
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="TicketSearch.html">Ticket Search</a></li>
                    <li><a href="HowItWorks.html">How It Works</a></li>
                    <li><a href="FAQ.html">FAQ</a></li>
                    <li><a href="ContactUs.html">Contact Us</a></li>
                    <li><a href="Login.html">Login/Sign Up</a></li>
                    <li><a href="Terms.html">Terms & Privacy</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- ---------------------- -->

    <!-- <div class="content">
        <h2 class="section-title">Violation: Speeding in a Residential Zone</h2>
        <p><strong>Legal Text:</strong> State Law Code 46.2-878: Speed Limits in Residential Areas</p>
        <p>(a) It shall be unlawful for any person to drive a motor vehicle on the highways of the Commonwealth at a
            speed in excess of twenty-five miles per hour in a business or residential district when the applicable
            speed limit is not otherwise indicated by signs.</p>
        <p>(b) A violation of this section shall constitute a traffic infraction punishable by a fine of not more than
            $200 for a first offense and $500 for a second or subsequent offense.</p>

        <h3 class="section-subtitle">Simplified Explanation:</h3>
        <ul>
            <li><strong>Speed Limit:</strong> In residential areas, the speed limit is set to 25 mph unless signs
                indicate otherwise. This is to ensure the safety of residents, pedestrians, and children who may be
                playing in the area.</li>
            <li><strong>Penalties:</strong> If you are caught driving faster than 25 mph in a residential zone:
                <ul>
                    <li>For the first offense, you may be fined up to $200.</li>
                    <li>For any additional offenses, the fine can go up to $500.</li>
                </ul>
            </li>
        </ul>

        <h3 class="section-subtitle">What You Should Do:</h3>
        <ul>
            <li>Always check for speed limit signs when driving in residential areas.</li>
            <li>Maintain a speed of 25 mph or lower if no signs are present.</li>
            <li>If you receive a ticket for speeding, you can choose to pay the fine or contest it in court.</li>
        </ul> -->

    <div class="content">
        <h2 id="result-title">Search Results</h2>
        <div id="result-content">
            <!-- Dynamic content will be inserted here -->
        </div>

        <!-- ---------------------- -->


        <div class="question-section">
            <div class="question">
                <a href="#" id="simplify-law-btn" class="simplify-btn">Don't understand? Simplify!</a>
            </div>
            <div id="simplified-law"
                style="display: none; margin-top: 10px; background: #f9f9f9; padding: 10px; border-radius: 5px; color: #333; border: 1px solid #ccc;">
                Simplified text will appear here.
            </div>
            <!-- <div class="question">
                <label>Do you understand this law and the associated penalties?</label>
                <div class="question-buttons">
                    <label><input type="radio" name="understand-law" value="yes"> Yes</label>
                    <label><input type="radio" name="understand-law" value="no"> No</label>
                </div>
            </div> -->

            <div class="question">
                <label>Would you like to see examples of common defenses used in court for this type of
                    violation?</label>
                <div class="question-buttons">
                    <label><input type="radio" name="see-examples" value="yes"> Yes</label>
                    <label><input type="radio" name="see-examples" value="no"> No</label>
                </div>
            </div>

            <div class="question">
                <label>Do you need information on how to contest this ticket in court?</label>
                <div class="question-buttons">
                    <label><input type="radio" name="contest-ticket" value="yes"> Yes</label>
                    <label><input type="radio" name="contest-ticket" value="no"> No</label>
                </div>
            </div>
        </div>

        <div class="buttons">
            <a href="TicketSearch.html">Submit New Search</a>
            <a href="#" id="update-info-btn">Update Information</a>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Traffic Tamer | Simplifying Traffic Laws Across States | Developed by Team Pearl</p>
    </footer>

    <script>
        // Extract the current query parameters from the URL
        const currentParams = new URLSearchParams(window.location.search);

        // Find the "Update Information" button
        const updateInfoBtn = document.getElementById("update-info-btn");

        // Update the href of the button dynamically
        updateInfoBtn.href = `TicketSearch.html?${currentParams.toString()}`;
    </script>

    <script>
        // Extract the `law` query parameter from the URL
        const params = new URLSearchParams(window.location.search);
        const lawCode = params.get("law");

        const resultTitle = document.getElementById("result-title");
        const resultContent = document.getElementById("result-content");

        if (lawCode) {
            // Show a loading message
            resultContent.innerHTML = "<p>Loading content for law " + lawCode + "...</p>";

            // Fetch the content of the law file from the backend
            fetch(`/get-law?law=${encodeURIComponent(lawCode)}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error(`Error: ${response.statusText}`);
                    }
                    return response.text();
                })
                .then((data) => {
                    // Update the title
                    resultTitle.innerText = `Search Results for Law ${lawCode}`;
                    // Display the content of the law file
                    resultContent.textContent = data; // Use textContent to preserve the text formatting
                })
                .catch((error) => {
                    // Display an error message if something goes wrong
                    resultContent.innerHTML = `<p class="error">Could not retrieve content for law ${lawCode}. ${error.message}</p>`;
                });
        } else {
            // Handle missing law code
            resultContent.innerHTML = "<p class='error'>No law code provided. Please try again.</p>";
        }
    </script>

    <script>
        document.getElementById("simplify-law-btn").addEventListener("click", async (event) => {
            event.preventDefault(); // Prevent default link behavior
            const simplifiedLawContainer = document.getElementById("simplified-law");

            // Fetch the full text of the law from the `#result-content` container
            const lawText = document.getElementById("result-content").textContent.trim();

            // Display a loading message
            simplifiedLawContainer.style.display = "block";
            simplifiedLawContainer.innerHTML = "Processing... Please wait.";

            try {
                // Prepare the prompt for the ChatGPT API
                const prompt = `Please summarize the following law text in simple terms:\n\n${lawText}`;

                // Make the API call
                const response = await fetch("https://api.openai.com/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer API-KEY-GOES-HERE`,    // Replace with real API key
                        "Cache-Control": "no-cache" // Prevent caching of the request and response
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo",
                        messages: [
                            { role: "system", content: "You are a helpful assistant." },
                            { role: "user", content: prompt }
                        ],
                        temperature: 0.7,
                        max_tokens: 800
                    })
                });

                if (!response.ok) {
                    throw new Error(`Error: ${response.statusText}`);
                }

                const data = await response.json();
                const reply = data.choices[0].message.content;

                // Update the container with the simplified explanation
                simplifiedLawContainer.innerHTML = `<p>${reply}</p>`;
            } catch (error) {
                console.error("Error:", error);
                simplifiedLawContainer.innerHTML = "An error occurred while processing the request. Please try again.";
            }
        });
    </script>

</body>

</html>